function y = u(x,V,hs,C)
y = 0*x;
nh = length(hs) - 1;
for i = 1 : length(x)
    ix = sum(x(i)>=hs);
    if ix == 1
        y(i) = V(1)*(C(1,1)+C(2,1)*x(i)+C(3,1)*x(i)^2+C(4,1)*x(i)^3) + ...
            V(2)*(C(1,2)+C(2,2)*x(i)+C(3,2)*x(i)^2+C(4,2)*x(i)^3) + ...
            V(3)*(C(1,3)+C(2,3)*x(i)+C(3,3)*x(i)^2+C(4,3)*x(i)^3) + ...
            V(4)*(C(1,4)+C(2,4)*x(i)+C(3,4)*x(i)^2+C(4,4)*x(i)^3);
    elseif ix == 2
        y(i) = V(2)*(C(5,2)+C(6,2)*x(i)+C(7,2)*x(i)^2+C(8,2)*x(i)^3) + ...
            V(3)*(C(5,3)+C(6,3)*x(i)+C(7,3)*x(i)^2+C(8,3)*x(i)^3) + ...
            V(4)*(C(5,4)+C(6,4)*x(i)+C(7,4)*x(i)^2+C(8,4)*x(i)^3) + ...
            V(5)*(C(1,5)+C(2,5)*x(i)+C(3,5)*x(i)^2+C(4,5)*x(i)^3);
    elseif ix == 3
        y(i) = V(3)*(C(9,3)+C(10,3)*x(i)+C(11,3)*x(i)^2+C(12,3)*x(i)^3) + ...
            V(4)*(C(9,4)+C(10,4)*x(i)+C(11,4)*x(i)^2+C(12,4)*x(i)^3) + ...
            V(5)*(C(5,5)+C(6,5)*x(i)+C(7,5)*x(i)^2+C(8,5)*x(i)^3) + ...
            V(6)*(C(1,6)+C(2,6)*x(i)+C(3,6)*x(i)^2+C(4,6)*x(i)^3);
    elseif ix == nh + 1
        ix = nh;
        y(i) = V(ix)*(C(13,ix)+C(14,ix)*x(i)+C(15,ix)*x(i)^2+C(16,ix)*x(i)^3) + ...
            V(ix+1)*(C(9,ix+1)+C(10,ix+1)*x(i)+C(11,ix+1)*x(i)^2+C(12,ix+1)*x(i)^3) + ...
            V(ix+2)*(C(5,ix+2)+C(6,ix+2)*x(i)+C(7,ix+2)*x(i)^2+C(8,ix+2)*x(i)^3) + ...
            V(ix+3)*(C(1,ix+3)+C(2,ix+3)*x(i)+C(3,ix+3)*x(i)^2+C(4,ix+3)*x(i)^3);
    else
            y(i) = V(ix)*(C(13,ix)+C(14,ix)*x(i)+C(15,ix)*x(i)^2+C(16,ix)*x(i)^3) + ...
            V(ix+1)*(C(9,ix+1)+C(10,ix+1)*x(i)+C(11,ix+1)*x(i)^2+C(12,ix+1)*x(i)^3) + ...
            V(ix+2)*(C(5,ix+2)+C(6,ix+2)*x(i)+C(7,ix+2)*x(i)^2+C(8,ix+2)*x(i)^3) + ...
            V(ix+3)*(C(1,ix+3)+C(2,ix+3)*x(i)+C(3,ix+3)*x(i)^2+C(4,ix+3)*x(i)^3);
    end
end
end

