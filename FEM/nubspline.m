for i = 1 : nh+1
    hs(i) = sum(h0(1:i));
end

C = [];
b = [zeros(15,1); 1];
for n = 3 : nh-1
    

    A = [phig(0,hs(n-2)), phig(-1,0), phig(-1,0), phig(-1,0);...
        phig(1,hs(n-2)), phig(-1,0), phig(-1,0), phig(-1,0);...
        phig(2,hs(n-2)), phig(-1,0), phig(-1,0), phig(-1,0);
        phig(0,hs(n-1)), -phig(0,hs(n-1)), phig(-1,0), phig(-1,0);... 
        phig(1,hs(n-1)), -phig(1,hs(n-1)), phig(-1,0), phig(-1,0);...   
        phig(2,hs(n-1)), -phig(2,hs(n-1)), phig(-1,0), phig(-1,0);...  
        phig(-1,0), phig(0,hs(n)), -phig(0,hs(n)), phig(-1,0);... 
        phig(-1,0), phig(1,hs(n)), -phig(1,hs(n)), phig(-1,0);... 
        phig(-1,0), phig(2,hs(n)), -phig(2,hs(n)), phig(-1,0);... 
        phig(-1,0), phig(-1,0), phig(0,hs(n+1)), -phig(0,hs(n+1));... 
        phig(-1,0), phig(-1,0), phig(1,hs(n+1)), -phig(1,hs(n+1));... 
        phig(-1,0), phig(-1,0), phig(2,hs(n+1)), -phig(2,hs(n+1));...
        phig(-1,0), phig(-1,0), phig(-1,0), phig(0,hs(n+2));...
        phig(-1,0), phig(-1,0), phig(-1,0), phig(1,hs(n+2));...
        phig(-1,0), phig(-1,0), phig(-1,0), phig(2,hs(n+2));...
        zeros(1,16)]; 
    

    xp1 = hs(n-2) + (hs(n+2)-hs(n-2))/4;
    xp2 = hs(n-2) + (hs(n+2)-hs(n-2))/2;
    xp3 = hs(n-2) + (hs(n+2)-hs(n-2))*3/4;
    p1 = sum(xp1>hs(n-1:n+2));
    p2 = sum(xp2>hs(n-1:n+2));
    p3 = sum(xp3>hs(n-1:n+2));
    
    A(end, p1*4+1) = A(end, p1*4+1) + 1;
    A(end, p1*4+2) = A(end, p1*4+2) + xp1;
    A(end, p1*4+3) = A(end, p1*4+3) + xp1^2;
    A(end, p1*4+4) = A(end, p1*4+4) + xp1^3;
    A(end, p2*4+1) = A(end, p2*4+1) + 1;
    A(end, p2*4+2) = A(end, p2*4+2) + xp2;
    A(end, p2*4+3) = A(end, p2*4+3) + xp2^2;
    A(end, p2*4+4) = A(end, p2*4+4) + xp2^3;
    A(end, p3*4+1) = A(end, p3*4+1) + 1;
    A(end, p3*4+2) = A(end, p3*4+2) + xp3;
    A(end, p3*4+3) = A(end, p3*4+3) + xp3^2;
    A(end, p3*4+4) = A(end, p3*4+4) + xp3^3;
    
    c = inv(A)*b;
    C = [C, c];
    
end

A = [phig(0,0), phig(-1,0), phig(-1,0);... 
    phig(1,0), phig(-1,0), phig(-1,0);...   
    phig(0,hs(2)), -phig(0,hs(2)), phig(-1,0);...  
    phig(1,hs(2)), -phig(1,hs(2)), phig(-1,0);... 
    phig(2,hs(2)), -phig(2,hs(2)), phig(-1,0);...
    phig(-1,0), phig(0,hs(3)), -phig(0,hs(3));...  
    phig(-1,0), phig(1,hs(3)), -phig(1,hs(3));... 
    phig(-1,0), phig(2,hs(3)), -phig(2,hs(3));...
    phig(-1,0), phig(-1,0), phig(0,hs(4));...  
    phig(-1,0), phig(-1,0), phig(1,hs(4));... 
    phig(-1,0), phig(-1,0), phig(2,hs(4));...
    phig(-1,0), phig(-1,0), phig(0,hs(3))]; 
     


b = [zeros(1,11), 1/6]';

c = inv(A)*b;
C = [[c;phig(-1,0)'], C];

A = [phig(0,0), phig(-1,0);...   
    phig(0,hs(2)), -phig(0,hs(2));...  
    phig(1,hs(2)), -phig(1,hs(2));... 
    phig(2,hs(2)), -phig(2,hs(2));...
    phig(-1,0), phig(0,hs(3));...  
    phig(-1,0), phig(1,hs(3));... 
    phig(-1,0), phig(2,hs(3));...
    phig(-1,0), phig(0,hs(2))];

b = [zeros(1,7), 1/4]';

c = inv(A)*b;
C = [[c;phig(-1,0)';phig(-1,0)'], C];

C = [[1;-3/h0(2);3/h0(2)^2;-1/h0(2)^3;...
    phig(-1,0)';phig(-1,0)';phig(-1,0)'], C];

% C = [[phig(-1,0)';phig(-1,0)';phig(-1,0)';phig(-1,0)'], C];

A = [phig(0,hs(nh-2)), phig(-1,0), phig(-1,0);... 
    phig(1,hs(nh-2)), phig(-1,0), phig(-1,0);... 
    phig(2,hs(nh-2)), phig(-1,0), phig(-1,0);...   
    phig(0,hs(nh-1)), -phig(0,hs(nh-1)), phig(-1,0);...  
    phig(1,hs(nh-1)), -phig(1,hs(nh-1)), phig(-1,0);... 
    phig(2,hs(nh-1)), -phig(2,hs(nh-1)), phig(-1,0);...
    phig(-1,0), phig(0,hs(nh)), -phig(0,hs(nh));...  
    phig(-1,0), phig(1,hs(nh)), -phig(1,hs(nh));... 
    phig(-1,0), phig(2,hs(nh)), -phig(2,hs(nh));...
    phig(-1,0), phig(-1,0), phig(0,hs(nh+1));...  
    phig(-1,0), phig(-1,0), phig(1,hs(nh+1));...
    phig(-1,0), phig(0,hs(nh-1)), phig(-1,0)]; 
     


b = [zeros(1,11),1/6]';

c = inv(A)*b;
C = [C,[c;phig(-1,0)']];

A = [phig(0,hs(nh-1)), phig(-1,0);...  
    phig(1,hs(nh-1)), phig(-1,0);... 
    phig(2,hs(nh-1)), phig(-1,0);...   
    phig(0,hs(nh)), -phig(0,hs(nh));...  
    phig(1,hs(nh)), -phig(1,hs(nh));... 
    phig(2,hs(nh)), -phig(2,hs(nh));...
    phig(-1,0), phig(0,hs(nh+1));...
    phig(-1,0), phig(0,hs(nh))];

b = [zeros(1,7),1/4]';

c = inv(A)*b;
C = [C,[c;phig(-1,0)';phig(-1,0)']];

C = [C,[...
    -hs(nh)^3/h0(nh+1)^3;3*hs(nh)^2/h0(nh+1)^3;-3*hs(nh)/h0(nh+1)^3;1/h0(nh+1)^3;...
    phig(-1,0)';phig(-1,0)';phig(-1,0)']];


% C = [C,[phig(-1,0)';phig(-1,0)';phig(-1,0)';phig(-1,0)']];

    
